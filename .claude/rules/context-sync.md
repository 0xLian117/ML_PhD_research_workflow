---
paths: ["code/**"]
---
# Context Auto-Sync

## 触发条件

当修改了 `code/{name}/` 下的文件时，本规则自动生效。

## 规则

### 1. Commit 前同步 (必须)

在对 `code/{name}/` 执行 git commit 之前，**必须**先同步 `context/{name}.md`:

#### 文件树 (自动)
扫描 `code/{name}/` 实际目录，更新 `<!-- AUTO-GENERATED:tree -->` 标记区域内的文件树。
- 新增文件: 添加条目，标注 `# (新增)` 或根据代码内容写描述
- 删除文件: 移除条目
- 排除: `__pycache__/`, `.git/`, `outputs/`, `.eggs/`, `*.pyc`

#### 内容描述 (按需)
检查本次变更是否涉及以下内容，如涉及则更新对应 section:

| 变更类型 | 需要更新的 section |
|---------|-------------------|
| 新增/删除模块文件 | 项目结构 (自动), 概述中提及的模块列表 |
| 修改特征/维度 | 特征相关 section (如 "13 维原始特征", "10 维特征") |
| 修改模型架构 | 模型架构 section |
| 新增训练模式/命令 | 运行方式 / 训练模式 section |
| 修改配置项 | 配置说明 section |
| 完成 checklist 项 | 当前状态 checklist (打勾 ✓) |

**判断方法**: 对比本次 `git diff` 的内容与 context 文件描述，有出入即更新。

### 2. 大型重构后全面刷新

如果单次变更涉及 >= 5 个文件 或 架构性调整，执行全面刷新:
- 读 context 全文
- 逐 section 与实际代码对照
- 更新所有过时描述

### 3. 不要遗漏

context 文件是其他 session 理解项目的**唯一入口**。过时的 context 比没有 context 更危险（会误导）。
宁可多更新，不要漏更新。
